---
title: 'Lab 3: Exploring Happiness'
subtitle: "Due: Thursday 10/03/2019 by 10 pm"
author: "Ashley Anderson & Hexiang Zhang"

date: "09/26/2019"
output: html_document
---


## Background

The General Social Survey (GSS) has been run by NORC every other year since 1972 to keep track of current opinions across the United States. We are working with an excerpt of the dataset that covers years 1972 to 2016. The variable names along with a brief description are as follows: 

| Variable      | Description   |    
| ------------- |:-------------:| 
| Year          | Year for this respondent | 
| Age           | Age of respondent | 
| Sex           | Sex of respondent     | 
|....           | .....      | 

Now it's important to understand what each column stands for. You can find a codebook with explanations for each of the variables at https://gssdataexplorer.norc.org/


```{r}
library(classdata)
library(dplyr)

happy <- readRDS("HAPPY.rds")
names(happy) = tolower(names(happy))

```

## Data Cleaning 

Initial exploration revealed that some data processing was needed before we could proceed with further visualization. The table below shows the number of missing values for all variables before data cleaning. After this discovery, we changed all missing values labeled as "DK" and "IAP" as NA. The second table shows this was successful. 
```{r}
na.table <- data.frame()
for(i in 1:ncol(happy)){
  na.table[1,i] <- sum(is.na(happy[i]))
  na.table[2,i] <- length(grep("IAP", happy[,i]))
  na.table[3,i] <- length(grep("DK", happy[,i]))
}
names(na.table) <- colnames(happy)
rownames(na.table) <- c("NAs","IAP","DK")
na.table

happy2 <- happy

na_codes <- c("IAP", "DK", "")
for (i in seq_along(happy2)) {
  happy2[[i]][happy2[[i]] %in% na_codes] <- NA
}

na.table2 <- data.frame()
for(i in 1:ncol(happy2)){
  na.table2[1,i] <- sum(is.na(happy2[i]))
  na.table2[2,i] <- length(grep("IAP", happy2[,i]))
  na.table2[3,i] <- length(grep("DK", happy2[,i]))
}
names(na.table2) <- colnames(happy2)
rownames(na.table2) <- c("NAs","IAP","DK")
na.table2
```

Variables were also cast into the correct type in order to ease data visualization. Age appears to be a character variable, and should be numeric. All categorical variables need to be changed to type factor except partyid and polyviews. There are 335 instances where age appears as "89 OR OLDER". We changed this to show "89 OR OLDER" as 89 so the variable age can be changed to numeric.  
```{r}
str(happy2)
length(grep("89 OR OLDER", happy2$age))

for (i in 1:nrow(happy2)) {
  age <- happy2[i, 'age']
  if(!is.na(age)){
    if(age=="89 OR OLDER") {
      happy2[i, 'age'] <- 89
    }
  }
}

happy2$happy <- as.factor(happy2$happy)
happy2$age <- as.numeric(happy2$age)
happy2$sex <- as.factor(happy2$sex)
happy2$marital <- as.factor(happy2$marital)
happy2$degree <- as.factor(happy2$degree)
happy2$finrela <- as.factor(happy2$finrela)
happy2$health <- as.factor(happy2$health)
str(happy2)
```

Factors were also organized into meaningful order as follows: We ordered marital status by age, 
```{r}
happy2 %>% 
  group_by(marital) %>% 
  mutate(mean=mean(age)) %>%
  arrange(age)

marital.order <- order(as.data.frame(aggregate(happy2$age, by=list(happy2$marital), mean, na.rm=TRUE))[,"x"])

levels(happy2$marital)
sizes <- ordered(happy2$marital, levels = c("small", "medium", "large"))
```


## Data Exploration 

Two variables of interest are age and `...`. Their distributions are as follow: 
```{r}

library(ggplot2)

ggplot(data=happy2, aes(x=happy2$age)) + 
  geom_histogram(col="black", fill="white", bins=50, size = .5) + 
  labs(title="Histogram for Age", x="Age", y="Count")

```

The distribution for age is left skewed, suggesting that most people surveyed were younger people. 




